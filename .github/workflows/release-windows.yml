name: Release Windows
on: workflow_dispatch

jobs:
  publish_on_windows:
    runs-on: windows-latest
    steps:
    - uses: actions/checkout@v4

    - uses: actions/setup-node@v4
      with:
        cache: 'yarn'
        node-version: 23.x
    
    - uses: actions/setup-python@v5
      with:
        python-version: '3.10'

    - name: Install Python Setuptools
      run: python -m pip install setuptools

    - name: Install Dependencies
      run: yarn install

    - name: Build and Package App
      env:
        AZURE_CLIENT_ID: ${{ secrets.AZURE_CLIENT_ID }}
        AZURE_CLIENT_SECRET: ${{ secrets.AZURE_CLIENT_SECRET }}
        AZURE_TENANT_ID: ${{ secrets.AZURE_TENANT_ID }}

        AZURE_CERTIFICATE_PROFILE_NAME: ${{ secrets.AZURE_CERTIFICATE_PROFILE_NAME }}
        AZURE_CODE_SIGNING_ACCOUNT_NAME: ${{ secrets.AZURE_CODE_SIGNING_ACCOUNT_NAME }}
        AZURE_COMMON_NAME: ${{ secrets.AZURE_COMMON_NAME }}
        AZURE_ENDPOINT: ${{ secrets.AZURE_ENDPOINT }}
        
        EP_GH_IGNORE_TIME: true
        GH_OWNER: ${{ secrets.GH_OWNER }}
        GH_TOKEN: ${{ secrets.PAT_TOKEN }}
        MODE: 'production'
      run: yarn vendors && yarn package
